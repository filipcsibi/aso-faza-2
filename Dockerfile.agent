# Dockerfile for ADK Agent with adk-web interface
FROM python:3.11-slim

WORKDIR /app

# Copy requirements and install dependencies in steps to avoid resolution issues
COPY requirements.txt .

# Install in stages to help pip resolve dependencies
RUN pip install --upgrade pip && \
    pip install pyyaml python-box uvicorn fastapi watchdog authlib click && \
    pip install litellm && \
    pip install google-cloud-aiplatform==1.126.0 google-genai mcp anthropic opentelemetry-api opentelemetry-sdk && \
    pip install google-adk==1.21.0

# Copy agent code and configuration
COPY src ./src
COPY config ./config

# Set environment variables for Docker deployment
ENV MODEL_NAME=llama3.2:3b
ENV OLLAMA_HOST=http://ollama:11434
ENV MCP_URL=http://mcp-server:8000/mcp

# Expose adk-web port
EXPOSE 8000

# Run adk web interface
CMD ["adk", "web", "--port", "8000", "--host", "0.0.0.0"]
